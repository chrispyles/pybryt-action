# PyBryt Action

An action for running [PyBryt](https://microsoft.github.io/pybryt) as an automated assessment tool on GitHub repositories.

## Usage

The PyBryt action accepts the following inputs:

| Name | Required | Description |
|-----|-----|-----|
| `submission-path` | yes | The path to the submission file to run |
| `references` | yes | A newline-delimited list of paths or URLs to reference implementations |
| `additional-files` | no | A newline-delimited list of file paths to also trace when executing the submission |

For example, to run PyBryt on the [Fibonacci demo in the main repo](https://github.com/microsoft/pybryt/tree/main/demo/fibonacci), you could use

```yaml
name: Run PyBryt

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Run PyBryt
        uses: chrispyles/pybryt-action@main # TODO: update the version
        with:
          submission-path: demo/fibonacci/submissions/subm01.ipynb
          references: |
            https://raw.githubusercontent.com/microsoft/pybryt/main/demo/fibonacci/fibonacci_dyn.pkl
            https://raw.githubusercontent.com/microsoft/pybryt/main/demo/fibonacci/fibonacci_map.pkl
            https://raw.githubusercontent.com/microsoft/pybryt/main/demo/fibonacci/fibonacci_no_recurse.pkl
```

If you were using a notebook as a testing harness, you may want something like:

```yaml
- name: Run PyBryt
  uses: chrispyles/pybryt-action@main # TODO: update the version
  with:
    submission-path: harness.ipynb
    additional-files: |
      student_code.py
    references: |
      references/fibonacci_dyn.pkl
      references/fibonacci_map.pkl
      references/fibonacci_no_recurse.pkl
```

## Outputs

PyBryt will always print a report for each reference to the console, however it also outputs relevant artifacts to a few files that can be used for further processing.

| Name | Description |
|-----|-----|
| `report-path` | Path to a `.txt` file containing the report generated by PyBryt (the same one printed to the console |
| `results-path` | Path to a `.pkl` file containing the pickled list of result objects generated by PyBryt |
| `student-implementation-path` | Path to a `.pkl` file containing the pickled student implementation object generated by PyBryt from the submission |

For example, you may want to commit these as files in the student's repo:

```yaml
- name: Run PyBryt
  id: pybryt
  uses: chrispyles/pybryt-action@main # TODO: update the version
  with:
    # etc.
- name: Save, commit, and push results
  run: |
    mkdir -p results
    cp ${{ steps.pybryt.outputs.report-path }} results/report.txt
    cp ${{ steps.pybryt.outputs.results-path }} results/results.pkl
    cp ${{ steps.pybryt.outputs.student-implementation-path }} results/student-implementation.pkl
    git add results
    git commit -m "PyBryt results for ${{ github.sha }}"
    git push
```

With these files, you could use a script like this to unpickle these objects in Python:

```python
import base64
import dill
import json
import os
import pybryt

RESULTS_DIR = "results"

results: list[pybryt.ReferenceResult]
student_impl: pybryt.StudentImplementation

with open(os.path.join(RESULTS_DIR, "results.pkl"), "rb") as f:
  results = dill.load(f)

student_impl = pybryt.StudentImplementation.load(os.path.join(RESULTS_DIR, "student-implementation.pkl"))
```
